<html>
<head>
	<title>ow.persistState Demo</title>
	<meta charset="utf-8" />
	<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.3/css/base/jquery.ui.all.min.css">
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/dark.min.css">
	<style type="text/css">
		.examples>li {
			margin: 1em;
		}
		.resizable {
			background-color: lime;
			overflow: hidden;
		}
		body { background-color: #FAFAFC;}
		.separate {
			padding-bottom: 1em;
			margin-bottom: 1.5em;
			border-bottom: 1px solid #CCC;
		}
		.examples section { padding-top: 1.5em; }
		.hero-unit { padding: 1em; }
	</style>
</head>
<body>

<div class="container">
<h1 class="page-header">The persistState Widget <small>A Demo</small></h1>
<aside class="hero-unit">
	Check out the documentation and source code on <a href="https://github.com/togakangaroo/persistState">github</a> or <a href="https://bitbucket.org/togakangaroo/ow.persiststate">bitbucket</a>
</aside>
<div class="row-fluid separate">
	<p class="span8">
	Try playing around with the controls below and refreshing the page. Note that the state of these controls persists. This page loads jQuery, jQuery Ui, and the persistState widget. It then initializes everything like so:	
	</p>
	<div class="span4">
<pre><code class="javascript">$(function(){
	$('.persist-state').persistState();
})</code></pre>		
	</div>
</div>

<ul class="examples unstyled">
	<li class="row-fluid">	
		<section id="checkbox-example" class="span4">
			<label>
				<span class="label">This is a checkbox</span>
				<input type="checkbox" class="persist-state">
			</label>
		</section>
		<div class="span8">
			<p>This is what the html looks like:</p>
			<code class="example-html"></code>			
		</div>
	</li>

	<li class="row-fluid">
		<section id="input-text-example" class="span4">
			<label>
				<span class="label">This is text input</span>
				<input class="persist-state" placeholder="Type some text in here">
			</label>
		</section>
		<div class="span8">
			<p>This is what the html looks like:</p>
			<code class="example-html"></code>
		</div>
	</li>

	<li class="row-fluid">
		<section id="select-example" class="span4">
			<label>
				<span class="label">This is a selector</span>
				<select class="persist-state">
					<option value="1">Option 1</option>
					<option value="2">Option 2</option>
					<option value="3">Option 3</option>
				</select>
			</label>
		</section>
		<div class="span8">
			<p>This is what the html looks like:</p>
			<code class="example-html"></code>
		</div>
	</li>

	<li class="row-fluid">
		<section id="resizable-example" class="span4">
			<label>
				<div class="resizable persist-state">
					<p>This block is resizable with jQuery Ui resizable</p>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</div>
			</label>
		</section>
		<div class="span8">
			<p>This is what the html looks like:</p>
			<code class="example-html"></code>
		</div>
	</li>

	<li class="row-fluid" id="show-hide-example">
		<section class="span4">
			<p>
				Making custom elements and widgets work with persistState is dead simple.
				See those Show/Hide collapsers? I just implemented them myself, and they persist!
			</p>
			<p>
				Note, the controls do not have to be a jQuery Ui widget so long as it is possible
				to target them with jQuery selectors. Hint, it's relatively simple to
				<a href="http://james.padolsey.com/javascript/extending-jquerys-selector-capabilities/">define
					your own selectors</a>
			</p>
			<p>
				The key is to extend the <code>$.ow.persistState.elementPeristence</code> object and let it
				know how the object state should be both persisted and restored.
			</p>
		</section>
		<div class="span8">
			<p>Here is the code:</p>
			<pre><code class="javascript example"></code></pre>
		</div>
	</li>

</ul>

<section id="localStorage-contents" class="row-fluid hero-unit">
	<p>The following are the contents of persistState in your localStorage:</p>
	<pre><code class="javascript"></code></pre>
	<button class="clear-localStorage">Clear It Out</button>
	<aside>This will remove any unload events so your next refresh will not persist but following ones will.</aside>
</section>
</div>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/highlight.min.js"></script>
<script src="src/ow.widgets.persistState.js"></script>

<script type="text/javascript">
//Get all the code inserted
$(function(){
	$('.examples>li:has(.example-html)').each(function(i, el){
        var  code = $('section', el).html()
            ,allLines = code.split('\n')
            ,lines = allLines.filter(function(l){return !/\!function()/.test(l) && !/}\(\)/.test(l) }) //remove iife

            //shift over code to get rid of highest indentation level so that we can still use white-space: pre
            ,firstLineOfText = lines.filter(function(l){return l.trim()})[0]
            ,indentationLevel = firstLineOfText.match(/^\s+/)[0].length

            ,codeMinusIndentationLevel = lines.map(function(l){ return l.substr(indentationLevel)}).join('\n').trim()
            ;
		var $code = $('code.example-html', el).text( codeMinusIndentationLevel );
		$code.addClass('html').wrap('<pre>'); //for highlight.js
		hljs.highlightBlock($code[0]);
	})
	hljs.highlightBlock(
		$('#show-hide-example code.example').text( $('#collapsible-widget').html() )[0]
	);
})	
</script>

<script type="text/javascript">
//The localStorage view panel
$(function(){
	function showLocalStorage() {
		var code = JSON.stringify( JSON.parse(localStorage['//persistenceState']||'null'), null, 2);
		$('#localStorage-contents code').text(code);
	}
	$('.clear-localStorage').click(function(){ $(':ow-persistState').persistState('clear'); showLocalStorage(); });
	showLocalStorage();
})
</script>

<style type="text/css">
	.collapsible .toggle { float: right; }
	.collapsible .toggle:after { content: " ▲"; }
	.collapsible.collapsed .toggle:after { content: " ▼"; }
</style>
<script type="text/javascript" id="collapsible-widget">//A super-naive implementation of collapsible areas in a jQuery Ui widget
$.widget('demo.collapsible', { 
	_create: function() {
		this.element.wrapInner('<div class="collapsible-area">')
		this.$toggle = $('<div class="toggle">').text('Show/Hide').prependTo(this.element);
		this.$toggle.click(this.toggle.bind(this));
		this.element.addClass('collapsible');
	}
	,toggle: function(show) {
		show = typeof show == 'boolean' ? show : this.element.is('.collapsed');
		this.element.toggleClass('collapsed', !show);
		this.element.find('.collapsible-area')[show ? 'slideDown' : 'slideUp']();
	}
});

//Let persistState know how to serialize this widget
$.ow.persistState.elementPersistence[':demo-collapsible'] = {
    saveState: function($el) {
        return { collapsed: $el.is('.collapsed') };
    },
    restoreState: function($el, state) {
        if(!state) return;
        var widget = $el.data('demo-collapsible')
        widget.toggle(!state.collapsed);
    }
};
$(function(){
	//initialize the widget and make it persisted
	$('.examples>li').collapsible().persistState();
})
</script>

<script type="text/javascript">
$(function(){
	//initialize jquery ui widgets for the example
	$('.resizable').resizable();
	//initialize the persist state widget itself. The widget will attempt
	//to restore state upon initialization
	$('.persist-state').persistState();
})
</script>
</body>
</html>	